<!DOCTYPE html><html lang="null"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="blog my life"><title>express学习笔记（二）：JavaScript模块化 | 老宋</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">express学习笔记（二）：JavaScript模块化</h1><a id="logo" href="/.">老宋</a><p class="description">Less is more</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 文章</i></a><a href="/about/"><i class="fa fa-user"> 关于我</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">express学习笔记（二）：JavaScript模块化</h1><div class="post-meta">Jun 4, 2016<span> | </span><span class="category"><a href="/categories/express/">express</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>在正式开发express网站之前，我们需要深入了解一下JavaScript的模块化开发。在nodejs中，模块系统是按照CommonJS规范实现的。</p>
<h2 id="一：为什么要搞JavaScript模块化"><a href="#一：为什么要搞JavaScript模块化" class="headerlink" title="一：为什么要搞JavaScript模块化"></a>一：为什么要搞JavaScript模块化</h2><p>在2005年以前，那时候还没有ajax，JavaScript只为单个页面的提供一些基础的操作，如表单验证等，一个页面所需的JavaScript代码量很小，只要正常按照顺序执行即可。大概如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xx = xxx;</span><br><span class="line"><span class="keyword">if</span>(xx)&#123;</span><br><span class="line">	......</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2005年，Google在它的产品里使用了ajax异步刷新技术，大大改善了前端交互，使得该技术广为流传。这一技术使得原本后端的一些工作被交到前端，于是渐渐的，前端网页变的越来越重，代码量越来越大，逻辑越来越多，也越来约复杂。问题也渐渐暴露，主要如下：</p>
<ul>
<li><strong>变量污染</strong>：一处定义，到处使用，会导致变量值被莫名的改掉。</li>
<li><strong>命名冲突</strong>：如果两个变量名相同或者两个方法名相同，那么后面的将覆盖前面的。</li>
<li><strong>文件依赖</strong>：如果a.js依赖b.js，那么在页面引用时，后者必须在前者的前面，如下：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"b.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"a.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>为解决以上出现的问题，出现一下解决方法：</p>
<h3 id="1-对象写法"><a href="#1-对象写法" class="headerlink" title="1.对象写法"></a>1.对象写法</h3><p>把所有的模块都放到一个对象里去，如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">　<span class="keyword">var</span> o = &#123;</span><br><span class="line">　　　　<span class="keyword">var</span> _index : <span class="number">0</span>,</span><br><span class="line">　　　　f1 : <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line">　　　　f2 : <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">　　&#125;;</span><br></pre></td></tr></table></figure></p>
<p>上面的f1和f2方法都封装在o这个对象里面。使用时可直接为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">o.f1();</span><br></pre></td></tr></table></figure></p>
<p>但是其他的一些不希望被访问的变量也会被外面访问到，例如_index，而且还可以被修改，<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">o._index = <span class="number">12</span>;</span><br></pre></td></tr></table></figure></p>
<h3 id="2-立即执行函数写法"><a href="#2-立即执行函数写法" class="headerlink" title="2.立即执行函数写法"></a>2.立即执行函数写法</h3><p>使用该方法可以不暴露私有变量和私有方法。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o = (<span class="function"><span class="keyword">function</span>(<span class="params">0, $</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> _index = <span class="number">0</span>;</span><br><span class="line">	f1 : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">	f2 : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">	o.f1 = f1;</span><br><span class="line">	o.f2 = f2;</span><br><span class="line">	<span class="keyword">return</span> o;</span><br><span class="line">&#125;)(<span class="built_in">window</span>.o || &#123;&#125;, jQuery);</span><br></pre></td></tr></table></figure></p>
<p>这是一个自执行函数，使用该写法，在外面是无法访问到_index变量的。另外还要注意两点：<br>window.o || {}:可能在某处已经定义了o这个对象，所以在此处，将o对象作为自执行函数的参数传入进去，如果o未定义，则新建一个空的对象。最后将新方法挂载在o对象下面。<br>jQuery：这个自执行内部不直接依赖外部变量，所依赖的全部通过参数传入进去，这样除了保证模块的独立性，还可以让模块的依赖变的更加明显。</p>
<p>所以说到底，为什么要搞模块化。因为有了模块化我们就可以更加方便的组织自己的代码，也更加方便的使用别人的代码，需要什么功能就加载什么模块。<br>但是要搞模块化，就需要大家的模块写法和用法规范都一致，这样的模块才能被大家方便的使用。目前通行的JavaScript模块规范有两种，AMD和CommonJS。这里主要介绍CommonJS，因为nodejs的模块系统就是按照CommonJS规范实现的。</p>
<h2 id="二：nodejs的模块系统"><a href="#二：nodejs的模块系统" class="headerlink" title="二：nodejs的模块系统"></a>二：nodejs的模块系统</h2><p>在nodejs中，定义一个模块很方便，我们先新建一个文件，里面代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports.sum = sum;</span><br></pre></td></tr></table></figure></p>
<p>这个文件就是一个简单的模块，模块内部定义的变量在外部是无法访问的，所有需要被外部访问的方法都绑到exports这个对象上。<br>将该文件保存为square.js，并新建一个app.js，里面代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> square = <span class="built_in">require</span>(<span class="string">'./square.js'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(square.sum(<span class="number">3</span>, <span class="number">4</span>));</span><br></pre></td></tr></table></figure></p>
<p>运行命令 node app.js 即可查看到结果。node.js中将模块的定义和使用都封装的很方便。<br>在express中，routes文件下的每个文件都是一个模块，这些模块在app.js中统一加载，加载代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> routes = <span class="built_in">require</span>(<span class="string">'./routes/index'</span>);</span><br><span class="line"><span class="keyword">var</span> users = <span class="built_in">require</span>(<span class="string">'./routes/users'</span>);</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/'</span>, routes);</span><br><span class="line">app.use(<span class="string">'/users'</span>, users);</span><br></pre></td></tr></table></figure></p>
<p><strong>exports对象和require方法</strong><br>我们回到刚才square那个例子，当你执行命令 <code>node app.js</code> 后，node.js会对所有js文件进行一次预编译，这个过程中会对原有js文件内容进行一次彻底的包装，以刚才的app.js为例，包装之后的app.js文件大致如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">exports, require, module, __filename, __dirname</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> square = <span class="built_in">require</span>(<span class="string">'./square.js'</span>);</span><br><span class="line">	<span class="built_in">console</span>.log(square.sum(<span class="number">3</span>, <span class="number">4</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>这就解释了为什么我们在代码中可以直接使用exports对象和require方法。<br>而在预编译square.js时，最终返回的exports对象中，只有一个sum方法，这就确保了模块内部的变量以及私有方法是不会被外部调用。</p>
<p>以上简单介绍了JavaScript模块化的由来，以及如何在node.js中使用模块。</p>
<p><strong>参考文献</strong>：</p>
<ul>
<li><a href="http://www.infoq.com/cn/articles/nodejs-module-mechanism/" target="_blank" rel="external">http://www.infoq.com/cn/articles/nodejs-module-mechanism/</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2012/10/javascript_module.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2012/10/javascript_module.html</a></li>
<li><a href="http://www.cnblogs.com/lvdabao/p/js-modules-develop.html" target="_blank" rel="external">http://www.cnblogs.com/lvdabao/p/js-modules-develop.html</a></li>
</ul>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://wxsong.github.io/2016/06/04/express学习笔记（二）：JavaScript模块化/" data-id="cip100cus0006usvszozmv4ax" class="article-share-link">Aktie</a><div class="tags"><a href="/tags/express/">express</a></div><div class="post-nav"><a href="/2016/05/14/express学习笔记（一）：简介/" class="next">express学习笔记（一）：简介</a></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://wxsong.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 文章分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/express/">express</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/maven/">maven</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/express/" style="font-size: 15px;">express</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/06/04/express学习笔记（二）：JavaScript模块化/">express学习笔记（二）：JavaScript模块化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/14/express学习笔记（一）：简介/">express学习笔记（一）：简介</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/23/Maven插件：代码行统计/">Maven插件：代码行统计</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/17/Maven依赖总结/">Maven依赖总结</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">老宋.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>